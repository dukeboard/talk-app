<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>unamed | Talk-app</title>
    <style type="text/css">
      #editor {
        width:100%;
        height:100%;
      }
    </style>
		<link rel="stylesheet" href="shower/themes/talk/fonts/overpass/recommended.css">
		<script src="jquery.js"></script>
    <script src="goldenlayout.js"></script>
		<script src="highlight/highlight.pack.js"></script>
		<script src="markdown/markdown-it.min.js"></script>
		<script src="markdown/decorate.js"></script>
		<link type="text/css" rel="stylesheet" href="node_modules/golden-layout/src/css/goldenlayout-base.css" />
		<link type="text/css" rel="stylesheet" href="node_modules/golden-layout/src/css/goldenlayout-light-theme.css" />
		<link type="text/css" rel="stylesheet" href="shower/themes/talk/styles/screen-4x3.css" />
		<link type="text/css" rel="stylesheet" href="highlight/styles/agate.css" />
		<style>
			.hljs {
				border-radius: 5px;
				font-size: 20px;
			}
		</style>
</head>
<body>
	<script>
		var md = new window.markdownit({
			html:true,
			xhtmlOut:true,
			highlight: function (str, lang) {
				try {
				        return '<pre class="hljs"><code>' +
				               hljs.highlight(lang, str, true).value +
				               '</code></pre>';
				} catch (__) {}
    		return ''; // use external default escaping
  		}
		});
		function hr_section(tokens, idx, options, env, self) {
		  return '</section><section class=\"slide\">';
		};
		md.renderer.rules['hr'] = hr_section
		md.use(function attributes (md) {
  		md.core.ruler.push('curly_attributes', curlyAttrs)
		});
		var remote = window.remote;
	</script>
	<script>var require = { paths: { 'vs': 'monaco/vs' } };</script>
	<script src="monaco/vs/loader.js"></script>
	<script src="monaco/vs/editor/editor.main.nls.js"></script>
	<script src="monaco/vs/editor/editor.main.js"></script>

  <script>
  var config = {
      content: [{
          type: 'row',
        content:[{
              type: 'row',
              content:[{
									title:"editor",
                  type: 'component',
									width: 55,
                  componentName: 'editorPanel',
									showCloseIcon: false,
									showMaximiseIcon: false,
									showPopoutIcon: false,
              },{
									title:"viewer",
                  type: 'component',
                  componentName: 'viewerPanel',
									showCloseIcon: false,
									showMaximiseIcon: false,
									showPopoutIcon: false
              }]
          }]
      }]
  };
  var myLayout = new GoldenLayout( config );

	var slideContainer = document.createElement('div');
	slideContainer.id = 'slideContainer';
  slideContainer.classList.add("shower");
  slideContainer.classList.add("list");
  myLayout.registerComponent( 'viewerPanel', function(container){
		var bodyStyle = document.body.style;
		bodyStyle.setProperty('--slideWidth', 1024);
		bodyStyle.setProperty('--slideHeight', 768);
		bodyStyle.setProperty('--slidePreviewWidth', container.getElement().width());
		container.on('resize',function(){
			bodyStyle.setProperty('--slidePreviewWidth', container.getElement().width());
		});
		container.getElement().append(slideContainer);
		container.getElement().css("overflow","scroll");

	});

  myLayout.registerComponent( 'editorPanel', function(container){
/*
		function uriFromPath(_path) {
			var pathName = path.resolve(_path).replace(/\\/g, '/');
			if (pathName.length > 0 && pathName.charAt(0) !== '/') {
				pathName = '/' + pathName;
			}
			console.log(_path);
			//console.log(_path,'file://' + pathName);
			return encodeURI('file://' + pathName);
		}
		require.config({
			baseUrl: uriFromPath(path.join(__dirname, 'node_modules/monaco-editor/min'))
		});*/
		//self.module = undefined;
		//self.process.browser = true;
	//	require.config({ paths: { 'vs': 'monaco/vs' }});
	//	require(['vs/editor/editor.main'], function() {
			var editorDiv = document.createElement('div');
			editorDiv.id = 'editor';
			container.getElement().append(editorDiv);

			var editor = monaco.editor.create(editorDiv, {
				value: [
					'# Hello',
					'world'
				].join('\n'),
				language: 'markdown'
			});
			container.on('resize',function(){
				editor.layout();
			});
			remote.ipcRenderer.on('file-contents',function(event,arg){
				editor.setValue(arg);
			});
			remote.ipcRenderer.on('req-save',function(event,arg){
				arg.content = editor.getValue();
				remote.ipcRenderer.send('resp-save',arg);
			});
			editor.onDidChangeModelContent(function(){
				remote.ipcRenderer.send('edited');
				var contentResult = md.render(editor.getValue());

console.log(contentResult);

				var extResult = '<section class=\"slide\">'+contentResult+'</section>';
				slideContainer.innerHTML = extResult;
			});
			var contentResult = md.render(editor.getValue());
			var extResult = '<section class=\"slide\">'+contentResult+'</section>';
			slideContainer.innerHTML = extResult;


	//	});
	});
  myLayout.init();
  </script>
	</body>
</html>
